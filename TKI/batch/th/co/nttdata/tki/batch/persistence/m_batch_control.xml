<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="m_batch_control">
	<statement id="insertMBatchControl" parameterClass="java.util.Map">
		MERGE INTO m_batch_control b
			USING (SELECT #batchcode# as batchcode) t
			ON (b.batchcode = t.batchcode)
			WHEN MATCHED THEN
				UPDATE SET b.batchstatus = #batchstatus#, 
						   b.startdate = GETDATE(), 
						   b.finishdate = GETDATE(), 
						   b.runby = #runby#
			WHEN NOT MATCHED THEN
				INSERT (batchcode, batchname,batchstatus,startdate,finishdate,runby)
				VALUES(#batchcode#,#batchname#,#batchstatus#,GETDATE(),GETDATE(),#runby#);
	</statement>
	
	<update id="updateMBatchControl" parameterClass="java.util.Map">
		UPDATE m_batch_control
		SET batchstatus = #batchstatus#, finishdate = GETDATE(),runby = #runby#
		WHERE batchcode = #batchcode#;
	</update>
</sqlMap>